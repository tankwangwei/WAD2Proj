<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>TripPal Weather</title>
</head>

<body>

    City: <input type="text" id="city">
    <button id="get">Get weather</button>

    <p id="temperature"></p>
    <p id="dailyPredict"></p>

    <script>

        let cityEle = document.getElementById("city") //to get value
        let btnEle = document.getElementById("get") //for onclick event

        // btnEle.addEventListener("click", getWeatherOrig)
        btnEle.addEventListener("click", getGeo)


        //if the user presses enter key, getWeather
        cityEle.addEventListener("keyup", checkEnter);

        function checkEnter() {
            if (event.key == 'Enter') {
                getGeo();
            }
        }

        var latValue
        var lonValue

        function getGeo() {
            let city = cityEle.value
            let url = "http://api.openweathermap.org/geo/1.0/direct"
            let key = "4e1a69304c74566a0ebcf18acbafbc18"

            axios.get(url, {
                params: {
                    q: city,
                    appid: key

                }
            })

                .then(
                    response => {
                        console.log(response.data)
                        let data = response.data
                        latValue = data[0].lat
                        lonValue = data[0].lon
                        getWeather()
                    }
                )

                .catch(
                    error => {
                        console.log(error.message)
                    }
                )
        }


        function getWeather() {

            console.log(latValue)
            console.log(lonValue)

            let city = cityEle.value
            let url = "https://api.openweathermap.org/data/3.0/onecall"
            let key = "4e1a69304c74566a0ebcf18acbafbc18"

            axios.get(url, {
                params: {
                    lat: latValue,
                    lon: lonValue,
                    appid: key

                }
            })

                .then(
                    response => {
                        console.log(response.data)


                        let pPredictEle = document.getElementById("dailyPredict")
                        let pTemperatureEle = document.getElementById("temperature")

                        let data = response.data
                        let kelvin = data.current.temp
                        let degreeCelcius = kelvin - 273.15 //formula to convert kelvin to degree celcius
                        pTemperatureEle.innerText = degreeCelcius.toFixed(2) + "째C"

                        let predictDaily = data.daily
                        let ulElem = document.createElement("ul")

                        for (key in predictDaily) {
                            let liElem = document.createElement("li")
                            liElem.innerText = "Day " + key

                            let minTemp = data.daily[key].temp["min"]
                            minTemp = minTemp - 273.15
                            let maxTemp = data.daily[key].temp["max"]
                            maxTemp = maxTemp - 273.15
                            let summary = data.daily[key].summary

                            let liTempElem = document.createElement("li")
                            liTempElem.innerText = "Lowest Temperature: " + minTemp.toFixed(2) + "째C, Highest Temperature: " + maxTemp.toFixed(2) + "째C, " + summary

                            // Create a sublist (ul) for temperatures
                            let tempSubList = document.createElement("ul")
                            tempSubList.appendChild(liTempElem)

                            // Append the sublist to the main list item
                            liElem.appendChild(tempSubList)

                            // Append the main list item to the ulElem
                            ulElem.appendChild(liElem)
                        }

                        pPredictEle.innerText = "";
                        pPredictEle.appendChild(ulElem)

                    }
                )

                .catch(
                    error => {
                        console.log(error.message)
                    }
                )
        }

        // function getWeatherOrig() {

        //     let city = cityEle.value;
        //     let url = "https://api.openweathermap.org/data/2.5/weather" //remove the query part
        //     let key = "8d6f21e5351582a8051551f99ef3fa88"

        //     axios.get(url, {
        //         params: {
        //             q: city,
        //             appid: key

        //         }
        //     })

        //         .then(
        //             response => {
        //                 console.log(response.data)

        //                 let pWeatherEle = document.getElementById("weather")
        //                 let pTemperatureEle = document.getElementById("temperature")

        //                 let data = response.data
        //                 pWeatherEle.innerText = data.weather[0].description
        //                 let fahrenheit = data.main.temp
        //                 let degreeCelcius = (fahrenheit - 32) * 5 / 9
        //                 pTemperatureEle.innerText = degreeCelcius.toFixed(2) + "째C"
        //             }
        //         )

        //         .catch(
        //             error => {
        //                 console.log(error.message)
        //             }
        //         )
        // }
    </script>

</body>

</html>